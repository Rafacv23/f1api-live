---
import SessionNav from "@/components/SessionNav.astro";
import Layout from "@/layouts/Layout.astro";
import { f1api } from "@/lib/f1Api";
import { checkSprint } from "@/lib/utils";

const { year, round } = Astro.params;
export const prerender = false

// retrieve free practice sessions

let fp1
let fp2
let fp3
let raceInfo
let haveSprint: boolean | undefined

if(year && round){
    raceInfo = await f1api.getRaceInfo({year: parseInt(year), round: parseInt(round)})
    haveSprint = checkSprint(raceInfo)
    if(haveSprint){
        fp1 = await f1api.getFp1Results({year: parseInt(year), round: parseInt(round)})
    } else {
        fp1 = await f1api.getFp1Results({year: parseInt(year), round: parseInt(round)})
        fp2 = await f1api.getFp2Results({year: parseInt(year), round: parseInt(round)})
        fp3 = await f1api.getFp3Results({year: parseInt(year), round: parseInt(round)})
    }
}
---

<Layout>
    <div class="mb-8">
        {raceInfo?.race.map((race) => 
        <h1>Practice - {race?.circuit.country} {year}</h1>
        <SessionNav year={year} round={round} haveSprint={haveSprint} />
        <p>{race?.schedule.fp1.date}, {race?.circuit.circuitName}, round {race?.round}</p>
        )}
    </div>
    <div class="grid space-y-4">
        <h2>Practice 3</h2>
        <table class="table-auto w-full">
            <thead class="border-b bg-secondary text-primary">
                <tr>
                    <th class="py-4">Position</th>
                    <th>Driver</th>
                    <th>Team</th>
                    <th>Time</th>
                </tr>
            </thead>
            <tbody>
                {fp3?.races.fp3Results.map((result) => 
          <tr class="border-b">
            <td class="py-4">{result.fp3Id}</td>
            <td>{result.driver.name} {result.driver.surname}</td>
            <td>{result.team.teamName}</td>
            <td>{result.time}</td>
          </tr>
        )}
        </tbody>
    </table>
    <h2>Practice 2</h2>
    <table class="table-auto w-full">
        <thead class="border-b bg-secondary text-primary">
            <tr>
                <th class="py-4">Position</th>
                <th>Driver</th>
                <th>Team</th>
                <th>Time</th>
            </tr>
        </thead>
        <tbody>
            {fp2?.races.fp2Results.map((result) => 
          <tr class="border-b">
            <td class="py-4">{result.fp2Id}</td>
            <td>{result.driver.name} {result.driver.surname}</td>
            <td>{result.team.teamName}</td>
            <td>{result.time}</td>
          </tr>
        )}
        </tbody>
    </table>
    <h2>Practice 1</h2>
    <table class="table-auto w-full">
        <thead class="border-b bg-secondary text-primary">
            <tr>
                <th class="py-4">Position</th>
                <th>Driver</th>
                <th>Team</th>
                <th>Time</th>
            </tr>
        </thead>
        <tbody>
            {fp1?.races.fp1Results.map((result) => 
         <tr class="border-b">
            <td class="py-4">{result.fp1Id}</td>
            <td>{result.driver.name} {result.driver.surname}</td>
            <td>{result.team.teamName}</td>
            <td>{result.time}</td>
          </tr>
        )}
        </tbody>
    </table>
</div>
</Layout>