---
import SessionNav from "@/components/SessionNav.astro";
import Layout from "@/layouts/Layout.astro";
import { f1api } from "@/lib/f1Api";
import { checkSprint } from "@/lib/utils";

const { year, round } = Astro.params;
export const prerender = false

// retrieve qualifying results
let qualy;
let raceInfo

if(year && round){
    raceInfo = await f1api.getRaceInfo({year: parseInt(year), round: parseInt(round)})
    qualy = await f1api.getQualyResults({year: parseInt(year), round: parseInt(round)})
}

const haveSprint = checkSprint(raceInfo)
---

<Layout>
    <div class="mb-8">
        {raceInfo?.race.map((race) => 
        <h1>Qualifying - {race?.circuit.country} {year}</h1>
        <SessionNav year={year} round={round} haveSprint={haveSprint} />
        <p>{race?.schedule.qualy.date}, {race?.circuit.circuitName}, round {race?.round}</p>
        )}
    </div>
    {qualy && qualy.races ? (
        <>
            <ul class="grid grid-cols-1 gap-4">
                {qualy?.races?.qualyResults?.map((result) => (
                    <li id="card">
                        <h2>{result.driver?.name} {result.driver?.surname}</h2>
                        <p>Q3: {result.q3}</p>
                        <p>Q2: {result.q2}</p>
                        <p>Q1: {result.q1}</p>
                    </li>
                ))}
            </ul>
        </>
    ) : (
        <p>Session data is not available at the moment.</p>
    )}
</Layout>